# Basic Authentication for Longhorn UI
# This creates a simple basic auth setup for accessing Longhorn

# 1. Create a secret with basic auth credentials
# Username: admin, Password: longhorn123 (change this!)
apiVersion: v1
kind: Secret
metadata:
  name: longhorn-basic-auth
  namespace: longhorn-system
  labels:
    app.kubernetes.io/name: longhorn
    app.kubernetes.io/component: auth
type: Opaque
data:
  # admin:longhorn123 encoded properly for basic auth
  # Generated with: echo -n "admin:longhorn123" | htpasswd -niB admin | base64 -w 0
  users: YWRtaW46JGFwcjEkSGM2Z0M5ZGskbUhaWUlINlB1V2F4dVJHUXF0SzgwLwo=

---
# 2. Create Traefik middleware for basic auth
apiVersion: traefik.io/v1alpha1
kind: Middleware
metadata:
  name: longhorn-auth
  namespace: longhorn-system
  labels:
    app.kubernetes.io/name: longhorn
    app.kubernetes.io/component: auth
spec:
  basicAuth:
    secret: longhorn-basic-auth

---
# 3. Alternative: Create auth using external service (if you have an auth provider)
# apiVersion: traefik.io/v1alpha1
# kind: Middleware
# metadata:
#   name: longhorn-forward-auth
#   namespace: longhorn-system
# spec:
#   forwardAuth:
#     address: "http://auth-service.auth-namespace.svc.cluster.local"
#     authResponseHeaders:
#       - "X-Auth-User"
#       - "X-Auth-Email"