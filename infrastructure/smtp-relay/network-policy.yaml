apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: smtp-relay-network-policy
  namespace: smtp-relay
  labels:
    app: smtp-relay
spec:
  podSelector:
    matchLabels:
      app: smtp-relay
  policyTypes:
  - Ingress
  - Egress
  ingress:
  # Allow SMTP connections from any namespace (for cluster services)
  - ports:
    - protocol: TCP
      port: 587
  # Allow from any namespace
  - from:
    - namespaceSelector: {}
    ports:
    - protocol: TCP
      port: 587
  egress:
  # Allow outbound to mail.roadrunner.com
  - to: []
    ports:
    - protocol: TCP
      port: 587
    - protocol: TCP
      port: 25
  # Allow DNS resolution
  - to: []
    ports:
    - protocol: UDP
      port: 53
    - protocol: TCP
      port: 53